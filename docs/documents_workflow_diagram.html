<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document Analysis Workflow ‚Äî Resolution AI</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&family=Source+Code+Pro:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-tertiary: #0f3460;
            --accent-emerald: #00d9a5;
            --accent-emerald-dim: #00a87d;
            --accent-coral: #e94560;
            --accent-amber: #f39c12;
            --accent-sapphire: #3498db;
            --accent-violet: #9b59b6;
            --text-primary: #eaf4fc;
            --text-secondary: #a8c5db;
            --text-muted: #6b8ba4;
            --border: #2a4a6b;
            --shadow: rgba(0, 0, 0, 0.6);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cormorant Garamond', Georgia, serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.7;
            min-height: 100vh;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            border-bottom: 1px solid var(--border);
            padding: 3.5rem 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--accent-emerald), var(--accent-sapphire), var(--accent-coral));
        }

        header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 60%;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--accent-emerald), transparent);
        }

        header h1 {
            font-size: 2.8rem;
            font-weight: 600;
            color: var(--accent-emerald);
            letter-spacing: 0.08em;
            margin-bottom: 0.75rem;
            text-shadow: 0 2px 20px rgba(0, 217, 165, 0.3);
        }

        header p {
            color: var(--text-secondary);
            font-size: 1.25rem;
            max-width: 800px;
            margin: 0 auto;
        }

        .subtitle {
            margin-top: 0.5rem;
            font-size: 1rem !important;
            color: var(--text-muted) !important;
            font-style: italic;
        }

        /* Main container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2.5rem;
        }

        /* Overview Section */
        .overview-section {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, rgba(15, 52, 96, 0.5) 100%);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2.5rem;
            margin-bottom: 3rem;
            position: relative;
        }

        .overview-section::before {
            content: 'üìë';
            position: absolute;
            top: -20px;
            left: 30px;
            font-size: 2rem;
            background: var(--bg-primary);
            padding: 0 1rem;
        }

        .overview-section h2 {
            color: var(--accent-emerald);
            font-size: 1.6rem;
            margin-bottom: 1.5rem;
            padding-left: 0.5rem;
            border-left: 3px solid var(--accent-emerald);
        }

        .overview-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .overview-box {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border);
        }

        .overview-box h3 {
            color: var(--accent-sapphire);
            font-size: 1.1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .overview-box p, .overview-box li {
            color: var(--text-secondary);
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }

        .overview-box ul {
            list-style: none;
            padding-left: 0;
        }

        .overview-box li::before {
            content: '‚Üí';
            color: var(--accent-emerald);
            margin-right: 0.5rem;
        }

        /* Legend */
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 2rem;
            justify-content: center;
            margin-bottom: 3rem;
            padding: 1.75rem;
            background: var(--bg-secondary);
            border-radius: 16px;
            border: 1px solid var(--border);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            font-size: 1rem;
        }

        .legend-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid currentColor;
        }

        .legend-dot.init { background: var(--accent-sapphire); border-color: var(--accent-sapphire); }
        .legend-dot.analyze { background: var(--accent-violet); border-color: var(--accent-violet); }
        .legend-dot.process { background: var(--accent-emerald); border-color: var(--accent-emerald); }
        .legend-dot.aggregate { background: var(--accent-amber); border-color: var(--accent-amber); }

        /* Visual Flow Diagram */
        .visual-flow {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 3rem;
            margin: 3rem 0;
            overflow-x: auto;
        }

        .flow-title {
            text-align: center;
            margin-bottom: 2rem;
        }

        .flow-title h3 {
            color: var(--accent-emerald);
            font-size: 1.4rem;
        }

        .flow-svg {
            width: 100%;
            min-width: 900px;
            height: auto;
        }

        /* Step Cards */
        .steps-section {
            margin: 4rem 0;
        }

        .steps-section > h2 {
            text-align: center;
            color: var(--accent-emerald);
            font-size: 2rem;
            margin-bottom: 2.5rem;
        }

        .step-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 20px;
            margin-bottom: 2rem;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .step-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 50px var(--shadow);
        }

        .step-card.step-1 { border-left: 4px solid var(--accent-sapphire); }
        .step-card.step-2 { border-left: 4px solid var(--accent-violet); }
        .step-card.step-3 { border-left: 4px solid var(--accent-emerald); }
        .step-card.step-4 { border-left: 4px solid var(--accent-emerald); }
        .step-card.step-5 { border-left: 4px solid var(--accent-amber); }

        .step-header {
            padding: 1.75rem 2rem;
            display: flex;
            align-items: center;
            gap: 1.25rem;
            border-bottom: 1px solid var(--border);
            background: linear-gradient(90deg, rgba(0, 217, 165, 0.05), transparent);
        }

        .step-number {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-primary);
            flex-shrink: 0;
        }

        .step-1 .step-number { background: var(--accent-sapphire); }
        .step-2 .step-number { background: var(--accent-violet); }
        .step-3 .step-number { background: var(--accent-emerald); }
        .step-4 .step-number { background: var(--accent-emerald); }
        .step-5 .step-number { background: var(--accent-amber); }

        .step-title-group h3 {
            font-size: 1.5rem;
            color: var(--text-primary);
            margin-bottom: 0.3rem;
        }

        .step-title-group .file-name {
            font-family: 'Source Code Pro', monospace;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .step-body {
            padding: 2rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .step-info {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .info-block {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 1.25rem;
        }

        .info-block h4 {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .info-block h4.purpose { color: var(--accent-emerald); }
        .info-block h4.inputs { color: var(--accent-sapphire); }
        .info-block h4.outputs { color: var(--accent-coral); }

        .info-block p {
            font-size: 1.05rem;
            color: var(--text-secondary);
        }

        .info-block code {
            font-family: 'Source Code Pro', monospace;
            background: var(--bg-tertiary);
            padding: 0.15rem 0.5rem;
            border-radius: 4px;
            font-size: 0.85rem;
            color: var(--accent-sapphire);
        }

        .io-items {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .io-item {
            font-family: 'Source Code Pro', monospace;
            font-size: 0.8rem;
            padding: 0.3rem 0.7rem;
            border-radius: 6px;
            background: var(--bg-tertiary);
            color: var(--text-secondary);
        }

        .io-item.input { border: 1px solid var(--accent-sapphire); }
        .io-item.output { border: 1px solid var(--accent-coral); }

        /* Prompt Section */
        .prompt-section {
            background: linear-gradient(135deg, rgba(155, 89, 182, 0.15), rgba(155, 89, 182, 0.05));
            border: 1px solid rgba(155, 89, 182, 0.3);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .prompt-section h4 {
            color: var(--accent-violet);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .prompt-section h4::before {
            content: '‚ö°';
        }

        .prompt-name {
            font-family: 'Source Code Pro', monospace;
            font-size: 1.1rem;
            color: var(--accent-violet);
            font-weight: 600;
            margin-bottom: 1rem;
            padding: 0.5rem 1rem;
            background: var(--bg-primary);
            border-radius: 8px;
            display: inline-block;
        }

        .prompt-vars {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
        }

        .prompt-vars span {
            font-family: 'Source Code Pro', monospace;
            font-size: 0.75rem;
            padding: 0.25rem 0.6rem;
            border-radius: 4px;
            background: var(--bg-primary);
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }

        .prompt-description {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px dashed var(--border);
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        /* Tool Badge */
        .tool-section {
            background: linear-gradient(135deg, rgba(0, 217, 165, 0.15), rgba(0, 217, 165, 0.05));
            border: 1px solid rgba(0, 217, 165, 0.3);
            border-radius: 12px;
            padding: 1.25rem;
            margin-top: 1rem;
        }

        .tool-section h4 {
            color: var(--accent-emerald);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.75rem;
        }

        .tool-section h4::before {
            content: 'üîß';
            margin-right: 0.5rem;
        }

        .tool-name {
            font-family: 'Source Code Pro', monospace;
            font-size: 0.95rem;
            color: var(--accent-emerald);
            background: var(--bg-primary);
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            display: inline-block;
        }

        /* State Schema */
        .state-schema {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2.5rem;
            margin: 3rem 0;
        }

        .state-schema h3 {
            color: var(--accent-emerald);
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
            text-align: center;
        }

        .schema-categories {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
        }

        .schema-category {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .schema-category h4 {
            font-size: 1rem;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border);
        }

        .schema-category.input h4 { color: var(--accent-sapphire); }
        .schema-category.process h4 { color: var(--accent-emerald); }
        .schema-category.output h4 { color: var(--accent-coral); }

        .schema-item {
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: var(--bg-tertiary);
            border-radius: 8px;
        }

        .schema-item:last-child {
            margin-bottom: 0;
        }

        .schema-item .key {
            font-family: 'Source Code Pro', monospace;
            color: var(--accent-emerald);
            font-size: 0.9rem;
        }

        .schema-item .type {
            font-family: 'Source Code Pro', monospace;
            color: var(--text-muted);
            font-size: 0.75rem;
            margin-left: 0.5rem;
        }

        .schema-item .desc {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        /* Prompt Engineering Guide */
        .prompt-guide {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            border: 2px solid var(--accent-amber);
            border-radius: 20px;
            padding: 2.5rem;
            margin: 3rem 0;
            position: relative;
        }

        .prompt-guide::before {
            content: '‚úèÔ∏è';
            position: absolute;
            top: -18px;
            left: 30px;
            font-size: 1.8rem;
            background: var(--bg-primary);
            padding: 0 0.75rem;
        }

        .prompt-guide h3 {
            color: var(--accent-amber);
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .prompt-guide > p {
            color: var(--text-secondary);
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }

        .prompt-list {
            list-style: none;
        }

        .prompt-list li {
            padding: 1.5rem;
            background: var(--bg-primary);
            border-radius: 12px;
            margin-bottom: 1rem;
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 1.5rem;
            align-items: start;
            border: 1px solid var(--border);
            transition: border-color 0.3s ease;
        }

        .prompt-list li:hover {
            border-color: var(--accent-violet);
        }

        .prompt-list .name {
            font-family: 'Source Code Pro', monospace;
            color: var(--accent-violet);
            font-size: 0.95rem;
            font-weight: 600;
        }

        .prompt-list .purpose {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .prompt-list .purpose strong {
            color: var(--text-primary);
            font-weight: 500;
        }

        .prompt-list .purpose .vars {
            margin-top: 0.75rem;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        /* Data Types */
        .data-types {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2.5rem;
            margin: 3rem 0;
        }

        .data-types h3 {
            color: var(--accent-emerald);
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
            text-align: center;
        }

        .type-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
        }

        .type-card {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border);
        }

        .type-card h4 {
            font-family: 'Source Code Pro', monospace;
            color: var(--accent-sapphire);
            font-size: 1.1rem;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border);
        }

        .type-field {
            display: flex;
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            background: var(--bg-tertiary);
            border-radius: 6px;
        }

        .type-field .field-name {
            font-family: 'Source Code Pro', monospace;
            color: var(--accent-emerald);
            min-width: 180px;
        }

        .type-field .field-type {
            font-family: 'Source Code Pro', monospace;
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 2.5rem;
            border-top: 1px solid var(--border);
            color: var(--text-muted);
            font-size: 1rem;
            margin-top: 3rem;
        }

        footer strong {
            color: var(--accent-emerald);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .overview-content { grid-template-columns: 1fr; }
            .step-body { grid-template-columns: 1fr; }
            .schema-categories { grid-template-columns: 1fr; }
        }

        @media (max-width: 768px) {
            header h1 { font-size: 2rem; }
            .prompt-list li { grid-template-columns: 1fr; }
            .container { padding: 1.5rem; }
        }
    </style>
</head>
<body>
    <header>
        <h1>üìÑ Document Analysis Workflow</h1>
        <p>Automated evidence extraction pipeline that analyzes case documents, extracts relevant information, and generates document-backed recommendations</p>
        <p class="subtitle">Resolution AI ‚Äî Documents Workflow Documentation for Prompt Engineering</p>
    </header>

    <div class="container">
        <!-- Overview Section -->
        <section class="overview-section">
            <h2>What This Workflow Does</h2>
            <div class="overview-content">
                <div class="overview-box">
                    <h3>üéØ Purpose</h3>
                    <p>This workflow analyzes case-related documents to strengthen legal recommendations with documentary evidence. It takes an existing legal issue (with initial recommendations from case law analysis) and enriches it by examining all relevant documents.</p>
                </div>
                <div class="overview-box">
                    <h3>üìã Process Overview</h3>
                    <ul>
                        <li>Load the legal issue and existing recommendations</li>
                        <li>Determine which documents need examination</li>
                        <li>Extract relevant information from each document</li>
                        <li>Generate mini-verdicts based on document evidence</li>
                        <li>Synthesize into a final enriched recommendation</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Legend -->
        <div class="legend">
            <div class="legend-item">
                <div class="legend-dot init"></div>
                <span>Initialization & Data Loading</span>
            </div>
            <div class="legend-item">
                <div class="legend-dot analyze"></div>
                <span>Analysis & Focus Generation</span>
            </div>
            <div class="legend-item">
                <div class="legend-dot process"></div>
                <span>Document Processing</span>
            </div>
            <div class="legend-item">
                <div class="legend-dot aggregate"></div>
                <span>Final Aggregation</span>
            </div>
        </div>

        <!-- Visual Flow Diagram -->
        <div class="visual-flow">
            <div class="flow-title">
                <h3>Workflow Execution Flow</h3>
            </div>
            <svg class="flow-svg" viewBox="0 0 900 700" xmlns="http://www.w3.org/2000/svg">
                <!-- Background pattern -->
                <defs>
                    <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
                        <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#2a4a6b" stroke-width="0.3"/>
                    </pattern>
                    <linearGradient id="emeraldGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#00d9a5;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#00ffc8;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="violetGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#9b59b6;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#c27cdb;stop-opacity:1" />
                    </linearGradient>
                    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#6b8ba4"/>
                    </marker>
                    <marker id="arrowhead-emerald" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#00d9a5"/>
                    </marker>
                    <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
                        <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                        <feMerge>
                            <feMergeNode in="coloredBlur"/>
                            <feMergeNode in="SourceGraphic"/>
                        </feMerge>
                    </filter>
                </defs>
                <rect width="100%" height="100%" fill="url(#grid)"/>

                <!-- Connection Lines -->
                <!-- Start to Initialize -->
                <path d="M 450 35 L 450 60" stroke="#6b8ba4" stroke-width="2" marker-end="url(#arrowhead)"/>
                
                <!-- Initialize to Generate File Focus -->
                <path d="M 450 130 L 450 175" stroke="#6b8ba4" stroke-width="2" marker-end="url(#arrowhead)"/>
                
                <!-- Generate File Focus to Extract Document Info -->
                <path d="M 450 260 L 450 300" stroke="#6b8ba4" stroke-width="2" marker-end="url(#arrowhead)"/>
                
                <!-- Extract to Create Micro Verdicts -->
                <path d="M 450 385 L 450 430" stroke="#6b8ba4" stroke-width="2" marker-end="url(#arrowhead)"/>
                
                <!-- Create Micro Verdicts to Aggregate -->
                <path d="M 450 520 L 450 560" stroke="#6b8ba4" stroke-width="2" marker-end="url(#arrowhead)"/>
                
                <!-- Aggregate to END -->
                <path d="M 450 640 L 450 670" stroke="#00d9a5" stroke-width="2" marker-end="url(#arrowhead-emerald)"/>

                <!-- Loop indicator for Extract Document Info -->
                <path d="M 620 340 C 680 340, 680 340, 680 380 C 680 400, 680 400, 620 400" 
                      stroke="#00d9a5" stroke-width="2" stroke-dasharray="5,3" fill="none"/>
                <text x="700" y="370" fill="#00d9a5" font-family="Cormorant Garamond" font-size="11" text-anchor="start">loops for</text>
                <text x="700" y="385" fill="#00d9a5" font-family="Cormorant Garamond" font-size="11" text-anchor="start">each file</text>

                <!-- Loop indicator for Create Micro Verdicts -->
                <path d="M 620 465 C 680 465, 680 465, 680 505 C 680 525, 680 525, 620 525" 
                      stroke="#00d9a5" stroke-width="2" stroke-dasharray="5,3" fill="none"/>
                <text x="700" y="490" fill="#00d9a5" font-family="Cormorant Garamond" font-size="11" text-anchor="start">loops for</text>
                <text x="700" y="505" fill="#00d9a5" font-family="Cormorant Garamond" font-size="11" text-anchor="start">each doc</text>

                <!-- Nodes -->
                <!-- START -->
                <circle cx="450" cy="22" r="12" fill="#3498db" filter="url(#glow)"/>
                <text x="450" y="26" fill="#1a1a2e" font-family="Cormorant Garamond" font-size="12" font-weight="bold" text-anchor="middle">S</text>
                
                <!-- 1. Initialize State -->
                <rect x="280" y="65" width="340" height="60" rx="12" fill="#16213e" stroke="#3498db" stroke-width="2"/>
                <circle cx="310" cy="95" r="18" fill="#3498db"/>
                <text x="310" y="100" fill="#1a1a2e" font-family="Cormorant Garamond" font-size="14" font-weight="bold" text-anchor="middle">1</text>
                <text x="450" y="90" fill="#eaf4fc" font-family="Cormorant Garamond" font-size="16" font-weight="600" text-anchor="middle">Initialize State</text>
                <text x="450" y="110" fill="#6b8ba4" font-family="Source Code Pro" font-size="9" text-anchor="middle">üìÇ Load issue from verdict or court_issues.json</text>
                
                <!-- 2. Generate File Focus -->
                <rect x="280" y="180" width="340" height="75" rx="12" fill="#16213e" stroke="#9b59b6" stroke-width="2"/>
                <circle cx="310" cy="217" r="18" fill="#9b59b6"/>
                <text x="310" y="222" fill="#1a1a2e" font-family="Cormorant Garamond" font-size="14" font-weight="bold" text-anchor="middle">2</text>
                <text x="450" y="205" fill="#eaf4fc" font-family="Cormorant Garamond" font-size="16" font-weight="600" text-anchor="middle">Generate File Focus</text>
                <text x="450" y="225" fill="#9b59b6" font-family="Source Code Pro" font-size="10" text-anchor="middle">‚ö° documents_focus_area</text>
                <text x="450" y="245" fill="#6b8ba4" font-family="Source Code Pro" font-size="9" text-anchor="middle">üîß get_all_document_details</text>
                
                <!-- 3. Extract Document Info -->
                <rect x="280" y="305" width="340" height="75" rx="12" fill="#16213e" stroke="#00d9a5" stroke-width="2"/>
                <circle cx="310" cy="342" r="18" fill="#00d9a5"/>
                <text x="310" y="347" fill="#1a1a2e" font-family="Cormorant Garamond" font-size="14" font-weight="bold" text-anchor="middle">3</text>
                <text x="450" y="330" fill="#eaf4fc" font-family="Cormorant Garamond" font-size="16" font-weight="600" text-anchor="middle">Extract Document Info</text>
                <text x="450" y="350" fill="#9b59b6" font-family="Source Code Pro" font-size="10" text-anchor="middle">‚ö° documents_extract_content</text>
                <text x="450" y="370" fill="#6b8ba4" font-family="Source Code Pro" font-size="9" text-anchor="middle">üîß retrieve_document</text>
                
                <!-- 4. Create Micro Verdicts -->
                <rect x="280" y="435" width="340" height="80" rx="12" fill="#16213e" stroke="#00d9a5" stroke-width="2"/>
                <circle cx="310" cy="475" r="18" fill="#00d9a5"/>
                <text x="310" y="480" fill="#1a1a2e" font-family="Cormorant Garamond" font-size="14" font-weight="bold" text-anchor="middle">4</text>
                <text x="450" y="460" fill="#eaf4fc" font-family="Cormorant Garamond" font-size="16" font-weight="600" text-anchor="middle">Create Micro Verdicts</text>
                <text x="450" y="480" fill="#9b59b6" font-family="Source Code Pro" font-size="10" text-anchor="middle">‚ö° documents_create_micro_verdict</text>
                <text x="450" y="502" fill="#6b8ba4" font-family="Cormorant Garamond" font-size="10" text-anchor="middle">Generates verdict per document evidence</text>
                
                <!-- 5. Aggregate Recommendations -->
                <rect x="260" y="565" width="380" height="70" rx="12" fill="#16213e" stroke="#f39c12" stroke-width="2"/>
                <circle cx="295" cy="600" r="18" fill="#f39c12"/>
                <text x="295" y="605" fill="#1a1a2e" font-family="Cormorant Garamond" font-size="14" font-weight="bold" text-anchor="middle">5</text>
                <text x="450" y="590" fill="#eaf4fc" font-family="Cormorant Garamond" font-size="16" font-weight="600" text-anchor="middle">Aggregate Documents Recommendations</text>
                <text x="450" y="612" fill="#9b59b6" font-family="Source Code Pro" font-size="10" text-anchor="middle">‚ö° documents_aggregate_recommendations</text>

                <!-- END -->
                <circle cx="450" cy="685" r="12" fill="#00d9a5" filter="url(#glow)"/>
                <text x="450" y="689" fill="#1a1a2e" font-family="Cormorant Garamond" font-size="10" font-weight="bold" text-anchor="middle">END</text>

                <!-- Data Flow Labels -->
                <text x="110" y="95" fill="#3498db" font-family="Cormorant Garamond" font-size="11" font-weight="500">INPUT:</text>
                <text x="110" y="110" fill="#a8c5db" font-family="Source Code Pro" font-size="9">issue_index</text>
                <text x="110" y="123" fill="#a8c5db" font-family="Source Code Pro" font-size="9">issue (optional)</text>

                <text x="110" y="217" fill="#9b59b6" font-family="Cormorant Garamond" font-size="11" font-weight="500">OUTPUTS:</text>
                <text x="110" y="232" fill="#a8c5db" font-family="Source Code Pro" font-size="9">file_focus</text>
                <text x="110" y="245" fill="#a8c5db" font-family="Source Code Pro" font-size="9">file_names[]</text>

                <text x="110" y="342" fill="#00d9a5" font-family="Cormorant Garamond" font-size="11" font-weight="500">OUTPUTS:</text>
                <text x="110" y="357" fill="#a8c5db" font-family="Source Code Pro" font-size="9">document_infos[]</text>

                <text x="110" y="475" fill="#00d9a5" font-family="Cormorant Garamond" font-size="11" font-weight="500">OUTPUTS:</text>
                <text x="110" y="490" fill="#a8c5db" font-family="Source Code Pro" font-size="9">micro_verdicts[]</text>

                <text x="110" y="595" fill="#f39c12" font-family="Cormorant Garamond" font-size="11" font-weight="500">FINAL:</text>
                <text x="110" y="610" fill="#a8c5db" font-family="Source Code Pro" font-size="9">final_recommendation</text>
                <text x="110" y="623" fill="#a8c5db" font-family="Source Code Pro" font-size="9">final_suggestion</text>
            </svg>
        </div>

        <!-- Detailed Step Cards -->
        <section class="steps-section">
            <h2>Detailed Step-by-Step Guide</h2>

            <!-- Step 1: Initialize State -->
            <div class="step-card step-1">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <div class="step-title-group">
                        <h3>Initialize State</h3>
                        <span class="file-name">src/documents/nodes/initialize_state.py</span>
                    </div>
                </div>
                <div class="step-body">
                    <div class="step-info">
                        <div class="info-block">
                            <h4 class="purpose">‚öñÔ∏è Purpose</h4>
                            <p>Prepares the workflow by loading the legal issue and any existing recommendations from case law analysis. Sets up all default values to ensure the pipeline runs smoothly.</p>
                        </div>
                        <div class="info-block">
                            <h4 class="inputs">üì• Inputs</h4>
                            <div class="io-items">
                                <span class="io-item input">issue_index</span>
                                <span class="io-item input">issue (optional)</span>
                                <span class="io-item input">recommendation (optional)</span>
                                <span class="io-item input">suggestion (optional)</span>
                            </div>
                        </div>
                        <div class="info-block">
                            <h4 class="outputs">üì§ Outputs</h4>
                            <div class="io-items">
                                <span class="io-item output">issue</span>
                                <span class="io-item output">recommendation</span>
                                <span class="io-item output">suggestion</span>
                            </div>
                        </div>
                    </div>
                    <div class="step-info">
                        <div class="info-block" style="background: linear-gradient(135deg, rgba(52, 152, 219, 0.1), rgba(52, 152, 219, 0.05)); border: 1px solid rgba(52, 152, 219, 0.3);">
                            <h4 style="color: var(--accent-sapphire);">üìÇ Data Sources</h4>
                            <p><strong>Priority 1:</strong> Loads from saved verdict file<br>
                            <code>dataset/issue_verdicts/issue_{index}.json</code></p>
                            <p style="margin-top: 1rem;"><strong>Priority 2:</strong> Falls back to court issues<br>
                            <code>dataset/court_issues/court_issues.json</code></p>
                        </div>
                        <div class="info-block">
                            <h4 style="color: var(--text-muted);">üîÑ What Gets Loaded</h4>
                            <p>From the issue file:</p>
                            <ul style="margin-top: 0.5rem; list-style: none; padding-left: 0;">
                                <li>‚Ä¢ <code>date_event</code> ‚Äî When it happened</li>
                                <li>‚Ä¢ <code>undisputed_facts</code> ‚Äî Agreed facts</li>
                                <li>‚Ä¢ <code>claimant_position</code> ‚Äî Claimant's argument</li>
                                <li>‚Ä¢ <code>defendant_position</code> ‚Äî Defendant's argument</li>
                                <li>‚Ä¢ <code>legal_issue</code> ‚Äî The core question</li>
                                <li>‚Ä¢ <code>relevant_documents</code> ‚Äî Document list</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Generate File Focus -->
            <div class="step-card step-2">
                <div class="step-header">
                    <div class="step-number">2</div>
                    <div class="step-title-group">
                        <h3>Generate File Focus</h3>
                        <span class="file-name">src/documents/nodes/generate_file_focus.py</span>
                    </div>
                </div>
                <div class="step-body">
                    <div class="step-info">
                        <div class="info-block">
                            <h4 class="purpose">‚öñÔ∏è Purpose</h4>
                            <p>Analyzes the legal issue along with existing recommendations to determine which documents need examination and what specific information we should look for in each.</p>
                        </div>
                        <div class="info-block">
                            <h4 class="inputs">üì• Inputs</h4>
                            <div class="io-items">
                                <span class="io-item input">issue</span>
                                <span class="io-item input">recommendation</span>
                                <span class="io-item input">suggestion</span>
                                <span class="io-item input">all_document_details</span>
                            </div>
                        </div>
                        <div class="info-block">
                            <h4 class="outputs">üì§ Outputs</h4>
                            <div class="io-items">
                                <span class="io-item output">file_focus</span>
                                <span class="io-item output">file_names[]</span>
                            </div>
                        </div>
                        <div class="tool-section">
                            <h4>Tool Used</h4>
                            <span class="tool-name">get_all_document_details</span>
                            <p style="margin-top: 0.75rem; color: var(--text-secondary); font-size: 0.9rem;">
                                Retrieves metadata and summaries of all available case documents
                            </p>
                        </div>
                    </div>
                    <div class="prompt-section">
                        <h4>LangSmith Prompt</h4>
                        <div class="prompt-name">documents_focus_area</div>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">Determines which files to examine and what to look for in each</p>
                        <div class="prompt-vars">
                            <span>date_event</span>
                            <span>undisputed_facts</span>
                            <span>claimant_position</span>
                            <span>defendant_position</span>
                            <span>legal_issue</span>
                            <span>relevant_documents</span>
                            <span>all_document_details</span>
                            <span>recommendation</span>
                            <span>suggestion</span>
                        </div>
                        <div class="prompt-description">
                            <strong>Output:</strong> Returns <code>file_focus</code> (what to extract) and <code>file_names</code> (which files to examine)
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 3: Extract Document Info -->
            <div class="step-card step-3">
                <div class="step-header">
                    <div class="step-number">3</div>
                    <div class="step-title-group">
                        <h3>Extract Document Info</h3>
                        <span class="file-name">src/documents/nodes/extract_document_info.py</span>
                    </div>
                </div>
                <div class="step-body">
                    <div class="step-info">
                        <div class="info-block">
                            <h4 class="purpose">‚öñÔ∏è Purpose</h4>
                            <p>Loops through each identified document and extracts the specific information relevant to the legal issue using AI analysis. Creates a focused extraction based on the file_focus guidance.</p>
                        </div>
                        <div class="info-block">
                            <h4 class="inputs">üì• Inputs</h4>
                            <div class="io-items">
                                <span class="io-item input">file_names[]</span>
                                <span class="io-item input">file_focus</span>
                            </div>
                        </div>
                        <div class="info-block">
                            <h4 class="outputs">üì§ Outputs</h4>
                            <div class="io-items">
                                <span class="io-item output">document_infos[]</span>
                            </div>
                            <p style="margin-top: 0.75rem; font-size: 0.9rem; color: var(--text-secondary);">
                                Each DocumentInfo contains: <code>filename</code> and <code>extracted_info</code>
                            </p>
                        </div>
                        <div class="tool-section">
                            <h4>Tool Used</h4>
                            <span class="tool-name">retrieve_document</span>
                            <p style="margin-top: 0.75rem; color: var(--text-secondary); font-size: 0.9rem;">
                                Fetches full document content for each file
                            </p>
                        </div>
                    </div>
                    <div class="prompt-section">
                        <h4>LangSmith Prompt</h4>
                        <div class="prompt-name">documents_extract_content</div>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">Extracts relevant information from each document based on the focus area</p>
                        <div class="prompt-vars">
                            <span>filename</span>
                            <span>document_content</span>
                            <span>focus_area</span>
                        </div>
                        <div class="prompt-description">
                            <strong>Loop:</strong> This step runs once for EACH file in <code>file_names</code>. The AI reads the full document and extracts information relevant to the legal issue.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 4: Create Micro Verdicts -->
            <div class="step-card step-4">
                <div class="step-header">
                    <div class="step-number">4</div>
                    <div class="step-title-group">
                        <h3>Create Micro Verdicts</h3>
                        <span class="file-name">src/documents/nodes/create_micro_verdicts.py</span>
                    </div>
                </div>
                <div class="step-body">
                    <div class="step-info">
                        <div class="info-block">
                            <h4 class="purpose">‚öñÔ∏è Purpose</h4>
                            <p>For each extracted document information, generates a "micro verdict" ‚Äî a focused analysis of how that specific document evidence affects the legal issue. Each verdict suggests extensions to the recommendation and suggestion.</p>
                        </div>
                        <div class="info-block">
                            <h4 class="inputs">üì• Inputs</h4>
                            <div class="io-items">
                                <span class="io-item input">document_infos[]</span>
                                <span class="io-item input">issue</span>
                                <span class="io-item input">recommendation</span>
                                <span class="io-item input">suggestion</span>
                            </div>
                        </div>
                        <div class="info-block">
                            <h4 class="outputs">üì§ Outputs</h4>
                            <div class="io-items">
                                <span class="io-item output">micro_verdicts[]</span>
                            </div>
                            <p style="margin-top: 0.75rem; font-size: 0.9rem; color: var(--text-secondary);">
                                Each MicroVerdict contains:<br>
                                ‚Ä¢ <code>filename</code><br>
                                ‚Ä¢ <code>verdict_text</code><br>
                                ‚Ä¢ <code>recommendation_extension</code><br>
                                ‚Ä¢ <code>suggestion_extension</code>
                            </p>
                        </div>
                    </div>
                    <div class="prompt-section">
                        <h4>LangSmith Prompt</h4>
                        <div class="prompt-name">documents_create_micro_verdict</div>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">Generates a focused verdict based on each document's extracted information</p>
                        <div class="prompt-vars">
                            <span>filename</span>
                            <span>document_content</span>
                            <span>date_event</span>
                            <span>undisputed_facts</span>
                            <span>claimant_position</span>
                            <span>defendant_position</span>
                            <span>legal_issue</span>
                            <span>recommendation</span>
                            <span>extracted_info</span>
                        </div>
                        <div class="prompt-description">
                            <strong>Loop:</strong> Runs once for EACH document in <code>document_infos</code>. The verdict explains how the document evidence supports or challenges the existing recommendation.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 5: Aggregate Documents Recommendations -->
            <div class="step-card step-5">
                <div class="step-header">
                    <div class="step-number">5</div>
                    <div class="step-title-group">
                        <h3>Aggregate Documents Recommendations</h3>
                        <span class="file-name">src/documents/nodes/aggregate_documents_recommendations.py</span>
                    </div>
                </div>
                <div class="step-body">
                    <div class="step-info">
                        <div class="info-block">
                            <h4 class="purpose">‚öñÔ∏è Purpose</h4>
                            <p>Synthesizes all micro verdicts into a final, cohesive recommendation and suggestion. This step combines the original case law recommendation with all document-based evidence into a comprehensive, document-enriched conclusion.</p>
                        </div>
                        <div class="info-block">
                            <h4 class="inputs">üì• Inputs</h4>
                            <div class="io-items">
                                <span class="io-item input">issue</span>
                                <span class="io-item input">recommendation</span>
                                <span class="io-item input">suggestion</span>
                                <span class="io-item input">micro_verdicts[]</span>
                            </div>
                        </div>
                        <div class="info-block">
                            <h4 class="outputs">üì§ Outputs</h4>
                            <div class="io-items">
                                <span class="io-item output">final_recommendation</span>
                                <span class="io-item output">final_suggestion</span>
                            </div>
                            <p style="margin-top: 0.75rem; font-size: 0.9rem; color: var(--text-secondary);">
                                These are the final outputs of the workflow ‚Äî ready for legal review
                            </p>
                        </div>
                    </div>
                    <div class="prompt-section">
                        <h4>LangSmith Prompt</h4>
                        <div class="prompt-name">documents_aggregate_recommendations</div>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">Combines all micro verdicts into a final document-enriched recommendation</p>
                        <div class="prompt-vars">
                            <span>date_event</span>
                            <span>undisputed_facts</span>
                            <span>claimant_position</span>
                            <span>defendant_position</span>
                            <span>legal_issue</span>
                            <span>current_recommendation</span>
                            <span>current_suggestion</span>
                            <span>micro_verdicts</span>
                        </div>
                        <div class="prompt-description">
                            <strong>Final Output:</strong> Produces the enriched <code>recommendation</code> and <code>suggestion</code> that incorporate all documentary evidence.
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- State Schema -->
        <div class="state-schema">
            <h3>üìä State Schema ‚Äî Data Flowing Through the Pipeline</h3>
            <div class="schema-categories">
                <div class="schema-category input">
                    <h4>üì• Input Fields</h4>
                    <div class="schema-item">
                        <span class="key">issue_index</span>
                        <span class="type">int</span>
                        <div class="desc">Which issue to process (0-indexed from court_issues.json)</div>
                    </div>
                    <div class="schema-item">
                        <span class="key">issue</span>
                        <span class="type">Issue</span>
                        <div class="desc">The loaded court issue with date, facts, positions, and legal question</div>
                    </div>
                    <div class="schema-item">
                        <span class="key">recommendation</span>
                        <span class="type">str</span>
                        <div class="desc">Initial recommendation from case law analysis</div>
                    </div>
                    <div class="schema-item">
                        <span class="key">suggestion</span>
                        <span class="type">str</span>
                        <div class="desc">Initial suggestions from case law analysis</div>
                    </div>
                </div>
                <div class="schema-category process">
                    <h4>‚öôÔ∏è Processing Fields</h4>
                    <div class="schema-item">
                        <span class="key">file_focus</span>
                        <span class="type">str</span>
                        <div class="desc">What information to extract from documents</div>
                    </div>
                    <div class="schema-item">
                        <span class="key">file_names</span>
                        <span class="type">List[str]</span>
                        <div class="desc">List of document filenames to examine</div>
                    </div>
                    <div class="schema-item">
                        <span class="key">document_infos</span>
                        <span class="type">List[DocumentInfo]</span>
                        <div class="desc">Extracted information from each document</div>
                    </div>
                    <div class="schema-item">
                        <span class="key">micro_verdicts</span>
                        <span class="type">List[MicroVerdict]</span>
                        <div class="desc">Individual verdicts from each document</div>
                    </div>
                </div>
                <div class="schema-category output">
                    <h4>üì§ Output Fields</h4>
                    <div class="schema-item">
                        <span class="key">final_recommendation</span>
                        <span class="type">str</span>
                        <div class="desc">Document-enriched legal recommendation</div>
                    </div>
                    <div class="schema-item">
                        <span class="key">final_suggestion</span>
                        <span class="type">str</span>
                        <div class="desc">Updated next steps and suggestions</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Types -->
        <div class="data-types">
            <h3>üìã Data Types Reference</h3>
            <div class="type-grid">
                <div class="type-card">
                    <h4>Issue</h4>
                    <div class="type-field">
                        <span class="field-name">date_event</span>
                        <span class="field-type">str</span>
                    </div>
                    <div class="type-field">
                        <span class="field-name">undisputed_facts</span>
                        <span class="field-type">str</span>
                    </div>
                    <div class="type-field">
                        <span class="field-name">claimant_position</span>
                        <span class="field-type">str</span>
                    </div>
                    <div class="type-field">
                        <span class="field-name">defendant_position</span>
                        <span class="field-type">str</span>
                    </div>
                    <div class="type-field">
                        <span class="field-name">legal_issue</span>
                        <span class="field-type">str</span>
                    </div>
                    <div class="type-field">
                        <span class="field-name">relevant_documents</span>
                        <span class="field-type">List[str]</span>
                    </div>
                </div>
                <div class="type-card">
                    <h4>DocumentInfo</h4>
                    <div class="type-field">
                        <span class="field-name">filename</span>
                        <span class="field-type">str</span>
                    </div>
                    <div class="type-field">
                        <span class="field-name">extracted_info</span>
                        <span class="field-type">str</span>
                    </div>
                </div>
                <div class="type-card">
                    <h4>MicroVerdict</h4>
                    <div class="type-field">
                        <span class="field-name">filename</span>
                        <span class="field-type">str</span>
                    </div>
                    <div class="type-field">
                        <span class="field-name">verdict_text</span>
                        <span class="field-type">str</span>
                    </div>
                    <div class="type-field">
                        <span class="field-name">recommendation_extension</span>
                        <span class="field-type">str</span>
                    </div>
                    <div class="type-field">
                        <span class="field-name">suggestion_extension</span>
                        <span class="field-type">str</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Prompt Engineering Guide -->
        <div class="prompt-guide">
            <h3>Prompt Engineering Guide</h3>
            <p>The following prompts are loaded from <strong>LangSmith</strong> and can be edited there. Each prompt directly influences how the AI analyzes documents and generates content at that stage. Modify these to fine-tune the analysis.</p>
            
            <ul class="prompt-list">
                <li>
                    <span class="name">documents_focus_area</span>
                    <span class="purpose">
                        <strong>Purpose:</strong> Determines which documents to examine and what information to extract from each.<br><br>
                        <strong>Key Considerations:</strong> This prompt receives the full legal context including the issue, positions, and existing recommendations. Edit this to change how files are selected and what the AI looks for.<br>
                        <div class="vars"><strong>Variables:</strong> date_event, undisputed_facts, claimant_position, defendant_position, legal_issue, relevant_documents, all_document_details, recommendation, suggestion</div>
                    </span>
                </li>
                <li>
                    <span class="name">documents_extract_content</span>
                    <span class="purpose">
                        <strong>Purpose:</strong> Extracts specific information from each document based on the focus area.<br><br>
                        <strong>Key Considerations:</strong> This prompt runs for each document. It should produce focused, relevant extractions. Edit this to change the extraction style or depth.<br>
                        <div class="vars"><strong>Variables:</strong> filename, document_content, focus_area</div>
                    </span>
                </li>
                <li>
                    <span class="name">documents_create_micro_verdict</span>
                    <span class="purpose">
                        <strong>Purpose:</strong> Creates a mini-verdict analyzing how each document's evidence affects the legal issue.<br><br>
                        <strong>Key Considerations:</strong> This produces three outputs: verdict_text, recommendation_extension, and suggestion_extension. Edit to change how document evidence is analyzed and connected to the legal issue.<br>
                        <div class="vars"><strong>Variables:</strong> filename, document_content, date_event, undisputed_facts, claimant_position, defendant_position, legal_issue, recommendation, extracted_info</div>
                    </span>
                </li>
                <li>
                    <span class="name">documents_aggregate_recommendations</span>
                    <span class="purpose">
                        <strong>Purpose:</strong> Synthesizes all micro verdicts into a final, cohesive recommendation.<br><br>
                        <strong>Key Considerations:</strong> This is the final synthesis step. Edit to change how the final recommendation incorporates documentary evidence and how comprehensive the output should be.<br>
                        <div class="vars"><strong>Variables:</strong> date_event, undisputed_facts, claimant_position, defendant_position, legal_issue, current_recommendation, current_suggestion, micro_verdicts</div>
                    </span>
                </li>
            </ul>
        </div>
    </div>

    <footer>
        <p><strong>Resolution AI</strong> ‚Äî Document Analysis Workflow Documentation</p>
        <p style="margin-top: 0.5rem;">Generated for prompt engineering and legal process understanding</p>
    </footer>
</body>
</html>

